<?xml version="1.0"?>
<project name="celtix-eclipse" basedir="../..">
    <!-- Targets for generating an eclipse project -->
    <import file="paths.xml"/>
    <import file="compile.xml"/>
    <import file="unittest.xml"/>
    <import file="systest.xml"/>
    <import file="clean.xml"/>

    <target name="eclipse.clean" depends="clean"/>
	<target name="eclipse.postclean" depends="unit.test.resources,system.test.resources,codegen"/>
    
    <property name="eclipse.project.workspace" value="${basedir}/../workspace"/>

    <target name="generate.eclipse.workspace" description="Generates an eclipse workspace"
        depends="codegen,src.compile,unittest.compile,systest.compile,generate.eclipse.workspace.dirs,generate.eclipse.workspace.settings"/>

    <target name="generate.eclipse.workspace.dirs">
        <mkdir dir="${eclipse.project.workspace}"/>
        <mkdir dir="${eclipse.project.workspace}/.metadata"/>
        <mkdir dir="${eclipse.project.workspace}/.metadata/.plugins"/>
        <mkdir dir="${eclipse.project.workspace}/.metadata/.plugins/com.atlassw.tools.eclipse.checkstyle"/>
        <mkdir dir="${eclipse.project.workspace}/.metadata/.plugins/org.eclipse.ui.workbench"/>
    </target>

    <target name="generate.eclipse.workspace.settings">
        <pathconvert property="eclipse.tools.dir" targetos="unix">
            <path>
                <pathelement location="${tools.dir}"/>
            </path>
        </pathconvert>
        <pathconvert property="eclipse.jaxws.home" targetos="unix">
            <path>
                <pathelement location="${jaxws.home}"/>
            </path>
        </pathconvert>
        <copy file="${basedir}/etc/eclipse/template.checkstyle-config.xml"
            tofile="${eclipse.project.workspace}/.metadata/.plugins/com.atlassw.tools.eclipse.checkstyle/checkstyle-config.xml"
            overwrite="yes">
            <filterset>
                <filter token="CHECKSTYLE_CONFIG_FILE" value="${basedir}${file.separator}etc${file.separator}checkstyle.xml"/>
            </filterset>
        </copy>
        <copy file="${basedir}/etc/eclipse/org.eclipse.jdt.core.prefs"
            tofile="${eclipse.project.workspace}/.metadata/.plugins/org.eclipse.core.runtime/.settings/org.eclipse.jdt.core.prefs"
            overwrite="yes">
            <filterset>
                <filter token="TOOLS_DIR" value="${eclipse.tools.dir}"/>
                <filter token="JAXWS_HOME" value="${eclipse.jaxws.home}"/>
            </filterset>
        </copy>
        <copy file="${basedir}/etc/eclipse/workingsets.xml"
            tofile="${eclipse.project.workspace}/.metadata/.plugins/org.eclipse.ui.workbench/workingsets.xml"
            overwrite="yes">
        </copy>
    </target>

</project>
