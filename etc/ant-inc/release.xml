<?xml version="1.0"?>
<project name="celtix-release" basedir="../../">
    <import file="compile.xml"/>
    <import file="javadoc.xml"/>

    <target name="release" depends="celtix.jar,publicapi.javadoc"
        description="Build a release kit">

        <mkdir dir="${build.release.dir}"/>
        <mkdir dir="${build.release.dir}/bin"/>
        <mkdir dir="${build.release.dir}/samples"/>
        <copy todir="${build.release.dir}">
            <fileset dir="${basedir}">
                <include name="LICENSE"/>
                <include name="NOTICE"/>
            </fileset>
        </copy>
        <copy includeEmptyDirs="false" todir="${build.release.dir}/bin">
            <fileset dir="${basedir}/bin">
                <include name="**/*"/>
            </fileset>
        </copy>
        <copy includeEmptyDirs="false" todir="${build.release.dir}/etc">
            <fileset dir="${basedir}/etc">
                <include name="logging.properties"/>
            </fileset>
        </copy>    	
        <copy includeEmptyDirs="false" todir="${build.release.dir}/samples">
            <fileset dir="${basedir}/samples">
                <include name="**/*"/>
                <exclude name="**/build/**/*"/>
                <exclude name="**/build"/>
            </fileset>
        </copy>
        <copy todir="${build.release.dir}/lib">
            <fileset dir="${build.lib.dir}">
                <include name="**/*"/>
            </fileset>
        </copy>
        <copy todir="${build.release.dir}/lib">
            <fileset dir="${tools.dir}">
                <include name="wsdl4j/**/*"/>
                <include name="tomcat/**/*"/>
                <include name="jaxws-ri/**/*"/>
            </fileset>
        </copy>
        <copy todir="${build.release.dir}/docs">
            <fileset dir="${basedir}/docs">
                <include name="**/*"/>
            </fileset>
        </copy>
        <copy todir="${build.release.dir}/docs/api">
            <fileset dir="${basedir}/build/javadoc/api">
                <include name="**/*"/>
            </fileset>
        </copy>
		

        <delete dir="${build.package.dir}" quiet="true"/>
        <mkdir dir="${build.package.dir}"/>
        <zip destfile="${build.package.dir}/celtix-${celtix.version}-bin.zip">
            <zipfileset prefix="celtix" dir="${build.release.dir}">
                <include name="**/*"/>
                <exclude name="**/tomcat/**/work/**/*"/>
                <exclude name="**/*.wc"/>
            </zipfileset>
        </zip>
        <zip destfile="${build.package.dir}/celtix-${celtix.version}-src.zip">
            <zipfileset prefix="celtix" dir="${basedir}">
                <include name="**/*"/>
                <exclude name="build"/>
                <exclude name="build/**/*"/>
                <exclude name="**/.*"/>
                <exclude name="NOTICE"/>
                <exclude name="**/tomcat/**/work/**/*"/>
            </zipfileset>
        </zip>
    </target>
	


    <target name="celtix.jar" depends="src.compile" description="build the celtix jar">
        <mkdir dir="${build.lib.dir}"/>
        <jar destfile="${celtix.jar}"
             basedir="${build.classes.dir}">
            <metainf dir="${basedir}/etc/metainf"/>
            <manifest>
                <attribute name="Class-Path" value="tomcat/5.5.9/bin/bootstrap.jar tomcat/5.5.9/bin/commons-daemon.jar tomcat/5.5.9/bin/commons-logging-api.jar tomcat/5.5.9/bin/tomcat-juli.jar tomcat/5.5.9/common/i18n/tomcat-i18n-en.jar tomcat/5.5.9/common/i18n/tomcat-i18n-es.jar tomcat/5.5.9/common/i18n/tomcat-i18n-fr.jar tomcat/5.5.9/common/i18n/tomcat-i18n-ja.jar tomcat/5.5.9/common/lib/commons-el.jar tomcat/5.5.9/common/lib/jasper-compiler-jdt.jar tomcat/5.5.9/common/lib/jasper-compiler.jar tomcat/5.5.9/common/lib/jasper-runtime.jar tomcat/5.5.9/common/lib/jsp-api.jar tomcat/5.5.9/common/lib/naming-factory-dbcp.jar tomcat/5.5.9/common/lib/naming-factory.jar tomcat/5.5.9/common/lib/naming-resources.jar tomcat/5.5.9/common/lib/servlet-api.jar tomcat/5.5.9/server/lib/catalina-ant.jar tomcat/5.5.9/server/lib/catalina-cluster.jar tomcat/5.5.9/server/lib/catalina-optional.jar tomcat/5.5.9/server/lib/catalina-storeconfig.jar tomcat/5.5.9/server/lib/catalina.jar tomcat/5.5.9/server/lib/commons-modeler.jar tomcat/5.5.9/server/lib/servlets-default.jar tomcat/5.5.9/server/lib/servlets-invoker.jar tomcat/5.5.9/server/lib/servlets-webdav.jar tomcat/5.5.9/server/lib/tomcat-ajp.jar tomcat/5.5.9/server/lib/tomcat-coyote.jar tomcat/5.5.9/server/lib/tomcat-http.jar tomcat/5.5.9/server/lib/tomcat-util.jar tomcat/5.5.9/server/webapps/host-manager/WEB-INF/lib/catalina-host-manager.jar tomcat/5.5.9/server/webapps/manager/WEB-INF/lib/catalina-manager.jar tomcat/5.5.9/server/webapps/manager/WEB-INF/lib/commons-fileupload-1.0.jar wsdl4j/1.5.1/wsdl4j.jar"/>
            </manifest>
        </jar>
    </target>
</project>
