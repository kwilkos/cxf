<?xml version="1.0"?>
<project name="celtix-unittests" basedir="../..">
    <!-- Targets for running the unittests -->

    <!-- Load the compile targets -->
    <import file="compile.xml"/>
    
    
    <target name="unit.test" description="Run the unit tests" depends="src.compile,unittest.compile,unit.test.nodeps"/>
        
        
    <target name="unit.test.nodeps" description="Run the unit tests">
        <mkdir dir="${basedir}/build/testresults/unit"/>

        <condition property="tests.filters" value="**/*Test.class">
            <not>
                <and>
                    <isset property="test.class"/>
                    <available classname="${test.class}" classpathref="unit.test.classpath"/>
                </and>
            </not>
        </condition>
        <condition property="unit.test.real.class" value="${test.class}">
                <isset property="test.class"/>
        </condition>
        <property name="unit.test.real.class" value="org.objectweb.celtix.testutils.NoTestTestcase"/>

        <junit fork="yes" haltonfailure="false"
        	failureproperty="unit.test.failed"
        	dir="${basedir}/build/classes-tests/unit"
        	timeout="100000"        
        	>
         	<jvmarg value="-Djaxws.home=${env.JAXWS_HOME}"/>        			
            <formatter type="brief" useFile="false"/>
            <formatter type="xml"/>
            <classpath>
                <path refid="unit.test.classpath"/>
            </classpath>
            <jvmarg value="-ea"/>

            <sysproperty key="java.util.logging.config.file" value="${basedir}/build/classes-tests/unit/logging.properties"/>

            
            <test name="${unit.test.real.class}" todir="${basedir}/build/testresults/unit" outfile="unittest-results" />
            <batchtest todir="${basedir}/build/testresults/unit">
                <fileset dir="${basedir}/build/classes-tests/unit">
                    <include name="${tests.filters}"/>
                </fileset>
            </batchtest>
        </junit>
    	<fail message="JUnit test failure." if="unit.test.failed"/>
    </target>

    <target name="run.standalone">
        <java fork="yes" classname="${standalone.class}">
            <classpath>
                <path refid="unit.test.classpath"/>
            </classpath>
            <sysproperty key="java.util.logging.config.file" value="${basedir}/build/classes-tests/unit/logging.properties"/>
            <sysproperty key="javax.xml.ws.EndpointFactory" value="org.objectweb.celtix.bus.EndpointFactoryImpl"/>
            <sysproperty key="javax.xml.ws.ServiceFactory" value="org.objectweb.celtix.bus.ServiceFactoryImpl"/>
        </java>
    </target>

</project>
